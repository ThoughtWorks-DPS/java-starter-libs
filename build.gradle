/*
 * This file was generated by the Gradle "init" task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
buildscript {
    ext {
        springBootVersion = "2.0.6.RELEASE"
    }
    repositories {
        mavenLocal()
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
    }
}

plugins {
    id "java"
    id "idea"
    id "maven-publish"
    id "java-library"
    id "pmd"
    id "checkstyle"
}

allprojects {


}

subprojects {

    ext.baseVersion = (project.hasProperty("version") ? project.version : "1")

    ext {
        springBootVersion = "2.0.6.RELEASE"
        slf4jVersion = "1.7.25"
        junitVersion = "5.2.0"
        lombokVersion = "1.16.12"
    }

    repositories {
        mavenLocal()
        mavenCentral()
        maven {
            url "s3://maven.k8starter.twdps.io/releases"
            authentication {
                awsIm(AwsImAuthentication) // load from EC2 role or env var
            }
        }
        maven {
            url "s3://maven.k8starter.twdps.io/snapshots"
            authentication {
                awsIm(AwsImAuthentication) // load from EC2 role or env var
            }
        }
    }

    apply plugin: "java"
    apply plugin: "eclipse"
    apply plugin: "idea"
    apply plugin: "io.spring.dependency-management"
    apply plugin: 'maven-publish'
//    apply plugin: "pmd"
//    apply plugin: "checkstyle"



    dependencies {
        compile "org.projectlombok:lombok:${lombokVersion}"
        testCompile "org.junit.jupiter:junit-jupiter-api:${junitVersion}"
        testRuntime "org.junit.jupiter:junit-jupiter-engine:${junitVersion}"
    }

    processResources {
        expand(project.properties)
    }


    publishing.publications {
            mavenJava(MavenPublication) {
                artifactId = project.name
                artifact jar.archivePath
            }
        }

    publishing.repositories {
            maven {
                url "s3://maven.k8starter.twdps.io/${project.version.endsWith('-SNAPSHOT') ? 'snapshot' : 'release'}"
                authentication {
                    awsIm(AwsImAuthentication) // load from EC2 role or env var
                }
            }
        }




//    checkstyle {
//        toolVersion = "8.10.1"
//        ignoreFailures = false
//        maxWarnings = 0
//        maxErrors = 0
//        sourceSets = [sourceSets.main, sourceSets.test]
//        reportsDir = file("$project.buildDir/reports/checkstyle")
//    }
//
//    pmd {
//        toolVersion = "6.4.0"
//        ignoreFailures = false
//        sourceSets = [sourceSets.main]
//        reportsDir = file("$project.buildDir/reports/pmd")
//        ruleSets = ["java-basic", "java-braces"]
//    }
}
